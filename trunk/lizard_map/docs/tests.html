<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>tests.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id="background"></div>
<div id='container'>
  
  <div class='section'>
    <div class='docs'><h1>tests.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      <p>We use the WorkspaceManager to find and create our workspaces</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_smoke</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>self.assertTrue(self.workspace_manager)  # It exists.</p>
<p>def test_load_or_create(self):
workspace_groups = self.workspace_manager.load_or_create()
self.assertTrue(workspace_groups)</p>
<p>def test_load(self):
workspace_groups = self.workspace_manager.load_or_create()
self.assertTrue(workspace_groups)
self.workspace_manager.save_workspaces()
errors = self.workspace_manager.load_workspaces()
self.assertEqual(errors, 0)</p>
<p>def test_save(self):
workspace_groups = self.workspace_manager.load_or_create()
self.assertTrue(workspace_groups)
self.workspace_manager.save_workspaces()</p>
<p>def test_empty(self):
workspace_groups = self.workspace_manager.load_or_create()
self.assertTrue(workspace_groups)
self.workspace_manager.empty()</p>
<p>class ViewsTest(TestCase):
fixtures = ('lizard_map', )</p>
<p>class MockRequest(object):
session = {}</p>
<p>def setUp(self):
self.client = Client()
self.workspace = Workspace()
self.workspace.save()
self.collage = WorkspaceCollage(workspace=self.workspace)
self.collage.save()</p>
<p>def test_homepage(self):
url = reverse('lizard_map_workspace',
<pre>kwargs={'workspace_id': self.workspace.id})
response = self.client.get(url)
self.assertEqual(response.status_code, 200)
</pre>
def test_wms(self):
url = reverse('lizard_map_wms',
kwargs={'workspace_id': self.workspace.id})
url += ('?LAYERS=basic&amp;SERVICE=WMS&amp;VERSION=1.1.1&amp;REQUEST=GetMap&amp;'
'STYLES=&amp;EXCEPTIONS=application%2Fvnd.ogc.se_inimage&amp;'
'FORMAT=image%2Fjpeg&amp;SRS=EPSG%3A900913&amp;'
'BBOX=430987.5469813,6803449.8497827,'
'669012.4530187,6896550.1502173&amp;'
'WIDTH=1557&amp;HEIGHT=609')
response = self.client.get(url)
self.assertEqual(response.status_code, 200)</p>
<p>def test_collage(self):
url = reverse('lizard_map.collage',
kwargs={'collage_id': self.collage.id})
response = self.client.get(url)
self.assertEqual(response.status_code, 200)</p>
<p>def test_collage_popup(self):
url = reverse('lizard_map.collage_popup',
kwargs={'collage_id': self.collage.id})
response = self.client.get(url)
self.assertEqual(response.status_code, 200)</p>
<p>def test_search_coordinates(self):
url = reverse('lizard_map.search_coordinates')
url += '?x=430987.5469813&amp;y=6817896.448126&amp;radius=100'
response = self.client.get(url)
self.assertEqual(response.status_code, 200)</p>
<p>def test_search_name(self):
url = reverse('lizard_map.search_name')
url += '?x=430987.5469813&amp;y=6817896.448126&amp;radius=100'
response = self.client.get(url)
self.assertEqual(response.status_code, 200)</p>
<p>def test_map_location_save(self):
Save map location, see if it doesn't crash</p>
<p>client = Client()
url = reverse('lizard_map.map_location_save')
response = client.post(url, {'left': 100, 'top': 100,
<pre>'right': 150, 'bottom': 150,
'base_layer_name': 'Google standard'})
self.assertEqual(response.status_code, 200)
</pre>
def test_map_location_load_default(self):
Save map location, then load it back.</p>
<p>url_load = reverse('lizard_map.map_location_load_default')
response_load = self.client.get(url_load)
self.assertEqual(response_load.status_code, 200)
result = json.loads(response_load.content)
self.assertEqual(
result['extent'],
{'top': '6964942', 'right': '1254790',
'left': '-14675', 'bottom': '6668977'})</p>
<p>class WorkspaceTest(TestCase):</p>
<p>def test_workspace_contains_items(self):
A workspace can contain workspace items</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">workspace1</span> <span class="o">=</span> <span class="n">Workspace</span><span class="p">()</span>
        <span class="n">workspace1</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">workspace1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">workspace1</span><span class="o">.</span><span class="n">workspace_items</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>  <span class="c"># Empty.</span>
        <span class="n">workspace_item1</span> <span class="o">=</span> <span class="n">workspace1</span><span class="o">.</span><span class="n">workspace_items</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="n">workspace_item2</span> <span class="o">=</span> <span class="n">workspace1</span><span class="o">.</span><span class="n">workspace_items</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">workspace1</span><span class="o">.</span><span class="n">workspace_items</span><span class="o">.</span><span class="n">all</span><span class="p">()),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">workspace_item1</span> <span class="ow">in</span> <span class="n">workspace1</span><span class="o">.</span><span class="n">workspace_items</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">workspace_item2</span> <span class="ow">in</span> <span class="n">workspace1</span><span class="o">.</span><span class="n">workspace_items</span><span class="o">.</span><span class="n">all</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>A workspace always has a name.  It is 'My Workspace' by</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>default."""
workspace = Workspace()
self.assertEquals(workspace.name, u'My Workspace')</p>
<p>def test_representation(self):
workspace = Workspace()
workspace.save()</p>
<h1>No errors: fine.  As long as we return something.</h1>
<p>self.assertTrue(unicode(workspace))</p>
<p>def test_absolute_url(self):
workspace = Workspace()
workspace.save()</p>
<h1>The initial version of this test asserted that the absolute URL ended</h1>
<h1>with '/workspace/1', apparantly assuming that the new workspace would</h1>
<h1>have id 1. However, that does not have to be the case.</h1>
<p>expected_end = '/workspace/%d/' % workspace.id
self.assertTrue(workspace.get_absolute_url().endswith(expected_end))</p>
<p>class WorkspaceClientTest(TestCase):</p>
<p>def setUp(self):
self.client = Client()</p>
<p>def test_workspace_item_add(self):
workspace = Workspace()
workspace.save()
url = reverse('lizard_map_workspace_item_add',
<pre>kwargs={'workspace_id': str(workspace.id)})
params = {'name': 'test workspace_item',
'adapter_class': 'test adapter_class',
'adapter_layer_json': '{"json"}'}
self.client.post(url, params)
self.assertTrue(workspace.workspace_items.filter())
</pre>
def test_workspace_item_reorder(self):
workspace = Workspace()
workspace.save()
workspace_item1 = workspace.workspace_items.create()
workspace_item2 = workspace.workspace_items.create()
url = reverse('lizard_map_workspace_item_reorder',
kwargs={'workspace_id': str(workspace.id)})
order = {'workspace-items[]': [
str(workspace_item2.id),
str(workspace_item1.id)]}
self.client.post(url, order)</p>
<p>self.assertEqual(workspace.workspace_items.all()[0], workspace_item2)
self.assertEqual(workspace.workspace_items.all()[1], workspace_item1)</p>
<p>def test_workspace_item_edit(self):
workspace = Workspace()
workspace.save()
workspace_item1 = workspace.workspace_items.create(
name='test workspaceitem')</p>
<p>url = reverse('lizard_map_workspace_item_edit')
self.client.post(
url,
{'workspace_item_id': str(workspace_item1.id), 'visible': 'false'})
self.assertEqual(
WorkspaceItem.objects.get(name='test workspaceitem').visible,
False)
self.client.post(
url,
{'workspace_item_id': str(workspace_item1.id), 'visible': 'true'})
self.assertEqual(
WorkspaceItem.objects.get(name='test workspaceitem').visible,
True)</p>
<p>def test_workspace_item_delete(self):
workspace = Workspace()
workspace.save()
workspace_item1 = workspace.workspace_items.create(
name='test workspaceitem')</p>
<p>url = reverse('lizard_map_workspace_item_delete')
self.client.post(
url,
{'object_id': str(workspace_item1.id)})
self.assertFalse(workspace.workspace_items.all())</p>
<p>def test_workspace_extent_temp(self):</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Tests</span> <span class="k">if</span> <span class="n">the</span> <span class="n">workspace</span> <span class="n">extent</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">crash</span> <span class="p">(</span><span class="n">although</span> <span class="n">the</span>
        <span class="n">content</span> <span class="n">will</span> <span class="n">be</span> <span class="n">meaningless</span><span class="p">)</span><span class="o">.</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>url = reverse('lizard_map_session_workspace_extent_temp')
result = self.client.get(url, {})
self.assertEqual(result.status_code, 200)</p>
<h1>Not testable without adapter</h1>
<h1>def test_workspace_extent(self):</h1>
<h1>"""</h1>
<h1>Tests if the workspace extent does not crash (although the</h1>
<h1>content will be meaningless).</h1>
<h1>"""</h1>
<h1>workspace = Workspace()</h1>
<h1>workspace.save()</h1>
<h1>workspace_item1 = workspace.workspace_items.create(</h1>
<p><pre>#         name='test workspaceitem')</p>
<h1>url = reverse('lizard_map_workspace_item_extent')</h1>
<h1>result = self.client.get(url, {</h1>
<h1>'workspace_item_id': workspace_item1.id})</h1>
<h1>self.assertEqual(result.status_code, 200)</h1>
<h1>self.assertTrue('north' in result.content)</h1>
</pre>

<h1>Not testable without adapter</h1>
<h1>def test_workspace_item_image(self):</h1>
<h1>workspace = Workspace()</h1>
<h1>workspace.save()</h1>
<h1>workspace_item1 = workspace.workspace_items.create(</h1>
<h1>name='test workspaceitem')</h1>
<h1>url = reverse('lizard_map_workspace_item_image')</h1>
<h1>url += '?identifier={test_identifier}'</h1>
<h1>response = self.client.get(url)</h1>
<h1>self.assertEqual(response.status_code, 200)</h1>
<h1>TODO: snippet stuff</h1>
<p>class WorkspaceItemTest(TestCase):</p>
<p>def test_has_adapter(self):
A workspace item can point to a method that returns a layer.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">workspace_item</span> <span class="o">=</span> <span class="n">WorkspaceItem</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">workspace_item</span><span class="o">.</span><span class="n">has_adapter</span><span class="p">())</span>
        <span class="n">workspace_item</span><span class="o">.</span><span class="n">adapter_class</span> <span class="o">=</span> <span class="s">&#39;todo&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">workspace_item</span><span class="o">.</span><span class="n">has_adapter</span><span class="p">())</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>There's at least one adapter entry point registered.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_entry_points_exist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>self.assertTrue(list(pkg_resources.iter_entry_points(
<pre>group='lizard_map.adapter_class')))
</pre>
def test_entry_point_lookup(self):
The string that identifies a method is looked up as a so-called</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">entry</span> <span class="n">point</span><span class="o">.</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        workspace_item = WorkspaceItem()</span>
<span class="s">        workspace_item.adapter_class = &#39;todo&#39;</span>
<span class="s">        self.assertRaises(lizard_map.models.AdapterClassNotFoundError,</span>
<span class="s">                          lambda: workspace_item.adapter,</span>

<span class="s">#DIVIDER</span>
<span class="s">                          )</span>
<span class="s">        workspace_item.adapter_class = &#39;adapter_dummy&#39;</span>
<span class="s">        workspace_item.adapter_layer_json = (&quot;{}&quot;)</span>
<span class="s">        self.assertTrue(isinstance(</span>
<span class="s">                workspace_item.adapter,</span>
<span class="s">                lizard_map.layers.AdapterDummy))</span>


<span class="s">#DIVIDER</span>
<span class="s">    def test_adapter_arguments(self):</span>
<span class="s">#DIVIDER</span>
<span class="s">        though.&quot;&quot;&quot;</span>
        <span class="n">workspace_item</span> <span class="o">=</span> <span class="n">WorkspaceItem</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">workspace_item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">workspace_item2</span> <span class="o">=</span> <span class="n">WorkspaceItem</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;bla&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">workspace_item2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;bla&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>^^^ lambda as adapter is a property and
assertRaises expects a callable.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">workspace_item</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>The layer method probably needs arguments. You can store them as a</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">TestDateRange</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>json string."""
workspace_item = WorkspaceItem()
self.assertTrue(isinstance(workspace_item.adapter_layer_arguments,
<pre>dict))
self.assertFalse(len(workspace_item.adapter_layer_arguments))
workspace_item.adapter_layer_json = '{"bla": "yes"}'
self.assertEquals(workspace_item.adapter_layer_arguments['bla'],
'yes')
</pre>
def test_name(self):
A workspace item always has a name.  It is blank by default,</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">period</span> <span class="o">=</span> <span class="n">current_period</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">PERIOD_DAY</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>No errors: fine.  As long as we return something.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_set_date_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Test daterange.py</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">timedelta_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">timedelta_end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>def setUp(self):</p>
<pre>class Mock(dict):
pass
</pre>

<p>self.request = Mock()
self.request.session = Mock()
self.today = datetime.datetime(2011, 4, 21)
self.almost_one_day = datetime.timedelta(
hours=23, minutes=59, seconds=59)</p>
<p>def _test_set_date_range(self, request):</p>
<p>set_date_range(self.request, now=self.today)</p>
<h1>Get current period, dt_start, dt_end</h1>
<p>period = current_period(self.request)
dt_start, dt_end = current_start_end_dates(
self.request, today=self.today)</p>
<p>return period, dt_start, dt_end</p>
<p>def test_current_start_end_dates(self):
dt_start, dt_end = current_start_end_dates(
self.request, today=self.today)
dt_start_expected = self.today + PERIOD_DAYS[PERIOD_DAY][0]
dt_end_expected = self.today + PERIOD_DAYS[PERIOD_DAY][1]</p>
<p>self.assertEquals(dt_start, dt_start_expected)
self.assertEquals(dt_end, dt_end_expected)</p>
<p>def test_current_period(self):
Test default period.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s">&#39;POST&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;period&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">PERIOD_OTHER</span><span class="p">),</span>
            <span class="s">&#39;dt_start&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span> <span class="o">+</span> <span class="n">timedelta_start</span><span class="p">,</span>
            <span class="s">&#39;dt_end&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span> <span class="o">+</span> <span class="n">timedelta_end</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">META</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">period</span><span class="p">,</span> <span class="n">dt_start</span><span class="p">,</span> <span class="n">dt_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_test_set_date_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">PERIOD_OTHER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">dt_start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span> <span class="o">+</span> <span class="n">timedelta_start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span>
            <span class="n">dt_end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span> <span class="o">+</span> <span class="n">timedelta_end</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">almost_one_day</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Set date range to period_day, then retrieve it back</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_set_date_range3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <h1>Fake Post</h1>
<p>self.request.method = 'POST'
self.request.POST = {
<pre>'period': str(PERIOD_DAY)}
self.request.META = {}
</pre>
period, dt_start, dt_end = self._test_set_date_range(self.request)</p>
<p>self.assertEquals(period, PERIOD_DAY)
self.assertEquals(dt_start, self.today + PERIOD_DAYS[PERIOD_DAY][0])
self.assertEquals(dt_end, self.today + PERIOD_DAYS[PERIOD_DAY][1])</p>
<p>def test_set_date_range2(self):
Set custom date range, then retrieve it back</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">daterange</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;dt_start&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span> <span class="o">+</span> <span class="n">timedelta_start_expected</span><span class="p">,</span>
                     <span class="s">&#39;dt_end&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">today</span> <span class="o">+</span> <span class="n">timedelta_end_expected</span><span class="p">,</span>
                     <span class="s">&#39;period&#39;</span><span class="p">:</span> <span class="n">period_expected</span><span class="p">}</span>
        <span class="n">period</span><span class="p">,</span> <span class="n">timedelta_start</span><span class="p">,</span> <span class="n">timedelta_end</span> <span class="o">=</span> <span class="n">deltatime_range</span><span class="p">(</span>
            <span class="n">daterange</span><span class="p">,</span> <span class="n">now</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>Fake Post</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">period_expected</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">timedelta_start</span><span class="o">.</span><span class="n">days</span><span class="p">,</span> <span class="n">timedelta_start_expected</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">timedelta_end</span><span class="o">.</span><span class="n">days</span><span class="p">,</span> <span class="n">timedelta_end_expected</span><span class="o">.</span><span class="n">days</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      <p>Set start date after end date: result must have dt_start&lt;dt_end</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_deltatime_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>timedelta_start = datetime.timedelta(days=20)
timedelta_end = datetime.timedelta(days=-15)</p>
<h1>Fake Post</h1>
<p>self.request.method = 'POST'
self.request.POST = {
<pre>'period': str(PERIOD_OTHER),
'dt_start': self.today + timedelta_start,
'dt_end': self.today + timedelta_end}
self.request.META = {}
</pre>
period, dt_start, dt_end = self._test_set_date_range(self.request)</p>
<p>self.assertEquals(period, PERIOD_OTHER)
self.assertTrue(dt_start &lt; dt_end)</p>
<p>def do_deltatime(
self, period_expected,
timedelta_start_expected, timedelta_end_expected):
Easy testing deltatime_range.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">timedelta_start_expected</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">timedelta_end_expected</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">period_expected</span> <span class="o">=</span> <span class="n">PERIOD_DAY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_deltatime</span><span class="p">(</span>
            <span class="n">period_expected</span><span class="p">,</span>
            <span class="n">timedelta_start_expected</span><span class="p">,</span> <span class="n">timedelta_end_expected</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      <p>Test on day accuracy, because "almost_one_day" is added to end.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_deltatime_range3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      <p>Deltatime_range</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      <p>timedelta_start_expected = datetime.timedelta(-1000)
timedelta_end_expected = datetime.timedelta(20)
period_expected = PERIOD_OTHER
self.do_deltatime(
<pre>period_expected,
timedelta_start_expected, timedelta_end_expected)
</pre>
def test_deltatime_range2(self):
Deltatime_range</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_fill_date_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">today</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      <p>Deltatime_range</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">twothousand</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">twothousandthree</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2003</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="n">SESSION_DT_START</span><span class="p">]</span> <span class="o">=</span> <span class="n">twothousand</span> <span class="o">-</span> <span class="n">today</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="n">SESSION_DT_END</span><span class="p">]</span> <span class="o">=</span> <span class="n">twothousandthree</span> <span class="o">-</span> <span class="n">today</span>
        <span class="n">day_one</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_start_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">twothousand</span> <span class="o">-</span> <span class="n">day_one</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_end_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">twothousandthree</span> <span class="o">-</span> <span class="n">day_one</span><span class="p">)</span><span class="o">.</span><span class="n">days</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>timedelta_start_expected = datetime.timedelta(-365)
timedelta_end_expected = datetime.timedelta(0)
period_expected = PERIOD_YEAR
self.do_deltatime(
<pre>period_expected,
timedelta_start_expected, timedelta_end_expected)
</pre></p>
<p>class TestAnimationSettings(TestCase):
Tests for animation.py.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_date_range_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">today</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      <p>Helper method: fill session with date range info.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">animation_settings</span> <span class="o">=</span> <span class="n">AnimationSettings</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">today</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="p">)</span>
        <span class="n">animation_settings</span><span class="o">.</span><span class="n">slider_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_start_days</span> <span class="o">+</span> <span class="mi">100</span>
        <span class="k">print</span> <span class="n">current_start_end_dates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">modified</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span>
            <span class="n">animation_settings</span><span class="o">.</span><span class="n">slider_position</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_start_days</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">[</span><span class="s">&#39;animation_settings&#39;</span><span class="p">][</span><span class="s">&#39;slider_position&#39;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date_start_days</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>date_start is 730119 days from day_one
date_end is 731215 days from day_one</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_initial_slider_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>Make sure _fill_date_range() works.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_date_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="p">)</span>
        <span class="n">animation_settings</span> <span class="o">=</span> <span class="n">AnimationSettings</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">today</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">animation_settings</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">&#39;min&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_start_days</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">&#39;max&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_end_days</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">&#39;step&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_end_days</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">&#39;selected_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="mi">2003</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>self._fill_date_range(today=today)
start, end = current_start_end_dates(self.request, today=today)
self.assertEquals(start.year, 2000)
self.assertEquals(end.year, 2003)</p>
<p>def setUp(self):</p>
<p>class Mock(dict):
<pre>pass
</pre>
self.request = Mock()
self.request.session = Mock()
self.today = datetime.datetime(2011, 4, 21)
self._date_range_helper(today=self.today)  # Set the request datetimes</p>
<p>def test_smoke(self):
animation_settings = AnimationSettings(
request=self.request, today=self.today)
self.assertTrue(animation_settings)  # It exists.</p>
<p>def test_session_initialisation(self):
self.assertFalse('animation_settings' in self.request.session)
AnimationSettings(self.request, today=self.today)
self.assertTrue('animation_settings' in self.request.session)</p>
<p>def test_slider_position(self):
Are the getters/setters working?</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_info_gathering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      <p>Slider position should be [max] if not initialised.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_date_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="p">)</span>
        <span class="n">animation_settings</span> <span class="o">=</span> <span class="n">AnimationSettings</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">today</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">today</span><span class="p">)</span>
        <span class="n">animation_settings</span><span class="o">.</span><span class="n">slider_position</span> <span class="o">=</span> <span class="o">-</span><span class="mi">400</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">animation_settings</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_start_days</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>In any case, it should not return a keyerror."""
animation_settings = AnimationSettings(
<pre>self.request, today=self.today)
self.assertEquals(animation_settings.slider_position,
self.date_end_days)
</pre>
def test_initial_info_gathering(self):
Do we return the correct date range and position?</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_impossible_beyond_max_corner_case</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      <p>Do we return the correct date range and position?</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="n">Tests</span> <span class="n">utility</span><span class="o">.</span><span class="n">py</span><span class="p">,</span> <span class="n">adapter</span><span class="o">.</span><span class="n">py</span><span class="p">,</span> <span class="n">mapnik_helper</span><span class="o">.</span><span class="n">py</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      <p>self._fill_date_range(self.today)
animation_settings = AnimationSettings(
<pre>self.request, today=self.today)
animation_settings.slider_position = self.date_start_days + 375
result = animation_settings.info()
self.assertEquals(result['min'], self.date_start_days)
self.assertEquals(result['max'], self.date_end_days)
self.assertEquals(result['step'], 1)
self.assertEquals(result['value'], self.date_start_days + 375)
self.assertEquals(result['selected_date'].year, 2001)
</pre>
def test_impossible_negative_corner_case(self):
Negative dates.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">st</span> <span class="o">=</span> <span class="n">float_to_string</span><span class="p">(</span><span class="mf">1.2345678</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">st</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">st</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="s">&#39;1.23&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>Value beyond the max possible.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_float_to_string2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      <p>self._fill_date_range(self.today)
animation_settings = AnimationSettings(
<pre>self.request, today=self.today)
animation_settings.slider_position = 1000000
result = animation_settings.info()</p>
<h1>Max available.</h1>
<p>self.assertEquals(result['value'], self.date_end_days)
</pre></p>
<p>class UtilityTest(TestCase):</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">st</span> <span class="o">=</span> <span class="n">float_to_string</span><span class="p">(</span><span class="mf">0.00000000012345</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">st</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">st</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="s">&#39;1.23&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="s">&#39;e&#39;</span> <span class="ow">in</span> <span class="n">st</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>class MockSettings(object):
<pre>pass
</pre>
def test_short_string(self):
input_names = [
<pre>'Loosdrechtse Plassen',
'wie niet waagt, wie niet wint',
'Reinout is een developer bij Nelen &amp; Schuurmans',
'Dit is nog een langere zin, deze moet ook goed werken',
]
for name in input_names:
short = short_string(name, 17)
self.assertTrue(len(short) &lt;= 17)
self.assertEquals(short[:5], name[:5])
</pre>
def test_float_to_string(self):
Let's input some nice floats.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_float_to_string5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      <p>Let's input some nice floats.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">st</span> <span class="o">=</span> <span class="n">float_to_string</span><span class="p">(</span><span class="mf">999999999.99</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">st</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">st</span><span class="p">[:</span><span class="mi">4</span><span class="p">],</span> <span class="s">&#39;1000&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      <p>st = float_to_string(12345.678)
self.assertTrue(len(st) &lt;= 10)
self.assertEquals(st[:4], '1234')</p>
<p>def test_float_to_string3(self):
Let's input some nice floats.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_float_to_string7</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      <p>Let's input some nice floats.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">st</span> <span class="o">=</span> <span class="n">float_to_string</span><span class="p">(</span><span class="s">&#39;1000&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="s">&#39;1000.00&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      <p>st = float_to_string(123456789012345)
self.assertTrue(len(st) &lt;= 10)
self.assertEquals(st[:4], '1.23')
self.assertTrue('e' in st)</p>
<p>def test_float_to_string6(self):
Let's input some nice floats.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_database_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>Let's input a string.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_database_settings2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      <p>self.assertEquals(float_to_string('string'), 'string')</p>
<p>def test_float_to_string8(self):
Let's input a string.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_database_settings3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>See if correct database settings are fetched when using new
style config.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      <p>See if correct database settings are fetched when using old
style config.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-42'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-42'>#</a>
      </div>
      <p>Take new style config if both setting styles are present.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adapter</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">(</span>
            <span class="k">lambda</span>
            <span class="n">identifier</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span>
                <span class="p">[{</span><span class="s">&#39;datetime&#39;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="s">&#39;unit&#39;</span><span class="p">:</span> <span class="s">&#39;none&#39;</span><span class="p">},</span>
                 <span class="p">{</span><span class="s">&#39;datetime&#39;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="mf">6.0</span><span class="p">,</span> <span class="s">&#39;unit&#39;</span><span class="p">:</span> <span class="s">&#39;none&#39;</span><span class="p">}])</span>
        <span class="n">aggregated_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapter</span><span class="o">.</span><span class="n">value_aggregate_default</span><span class="p">(</span>
            <span class="p">{},</span>
            <span class="p">{</span><span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;avg&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&#39;count_lt&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
             <span class="s">&#39;count_gte&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s">&#39;percentile&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">},</span>
            <span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">aggregated_values</span><span class="p">[</span><span class="s">&#39;min&#39;</span><span class="p">],</span> <span class="mf">5.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">aggregated_values</span><span class="p">[</span><span class="s">&#39;max&#39;</span><span class="p">],</span> <span class="mf">6.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">aggregated_values</span><span class="p">[</span><span class="s">&#39;avg&#39;</span><span class="p">],</span> <span class="mf">5.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">aggregated_values</span><span class="p">[</span><span class="s">&#39;count_lt&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">aggregated_values</span><span class="p">[</span><span class="s">&#39;count_gte&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-43'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-43'>#</a>
      </div>
      <p>def test_create_layer_from_query(self):
    """Difficult to test, just see if it crashes or not. Currently
    crashes when db does not exist
    """
    settings = self.MockSettings()
    settings.DATABASES = {
        'default': {
            'ENGINE': 'postgresql_psycopg2',
            'HOST': 'database_host',
            'USER': 'database_user',
            'PASSWORD': 'database_password',
            'NAME': 'database_name',
            },
        }</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">aggregated_values</span><span class="p">[</span><span class="s">&#39;percentile&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">5.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">aggregated_values</span><span class="p">[</span><span class="s">&#39;percentile&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">6.0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-44'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-44'>#</a>
      </div>
      <pre><code>q = "select * from dummy;"
projection = lizard_map.coordinates.RD
layer = create_layer_from_query(q, projection,
            user_settings=settings)
</code></pre>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-45'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-45'>#</a>
      </div>
      <p>First, implement values function</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">anchestors</span> <span class="o">=</span> <span class="n">AnchestorRegistration</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">anchestors</span><span class="o">.</span><span class="n">anchestor_of</span><span class="p">(</span><span class="s">&#39;child&#39;</span><span class="p">,</span> <span class="s">&#39;parent&#39;</span><span class="p">))</span>
        <span class="n">anchestors</span><span class="o">.</span><span class="n">register_parent</span><span class="p">(</span><span class="s">&#39;child&#39;</span><span class="p">,</span> <span class="s">&#39;parent&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">anchestors</span><span class="o">.</span><span class="n">anchestor_of</span><span class="p">(</span><span class="s">&#39;child&#39;</span><span class="p">,</span> <span class="s">&#39;parent&#39;</span><span class="p">))</span>
        <span class="n">anchestors</span><span class="o">.</span><span class="n">register_parent</span><span class="p">(</span><span class="s">&#39;grandchild&#39;</span><span class="p">,</span> <span class="s">&#39;child&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">anchestors</span><span class="o">.</span><span class="n">anchestor_of</span><span class="p">(</span><span class="s">&#39;grandchild&#39;</span><span class="p">,</span> <span class="s">&#39;parent&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">anchestors</span><span class="o">.</span><span class="n">anchestor_of</span><span class="p">(</span><span class="s">&#39;parent&#39;</span><span class="p">,</span> <span class="s">&#39;grandchild&#39;</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-46'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-46'>#</a>
      </div>
      <p>Percentile value depends on definition...</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">test_anchestor_registration2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-47'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-47'>#</a>
      </div>
      <p>Testing the color object</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Cycle</span> <span class="n">detection</span> <span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-48'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-48'>#</a>
      </div>
      <p>c = Color('ff8000')
self.assertEquals(c.r, 255)
self.assertEquals(c.g, 128)
self.assertEquals(c.b, 0)</p>
<p>def test_color2(self):
c = Color(None)
self.assertEquals(c.r, None)
self.assertEquals(c.g, None)
self.assertEquals(c.b, None)</p>
<p>class TestOperations(TestCase):</p>
<p>def test_anchestor_registration(self):
Check basic functionality</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Cycle</span> <span class="n">detection</span> <span class="mi">2</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-49'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-49'>#</a>
      </div>
      <p>The anchestor registration doesn't mind cycles</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Test</span> <span class="n">MapSettings</span> <span class="n">class</span><span class="o">.</span> <span class="n">Nothing</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">py</span><span class="p">,</span> <span class="n">so</span> <span class="n">revert</span> <span class="n">to</span>
        <span class="n">default</span> <span class="n">google</span> <span class="n">projection</span> <span class="ow">and</span> <span class="n">srid</span><span class="o">.</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-50'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-50'>#</a>
      </div>
      <p>anchestors = AnchestorRegistration()
anchestors.register_parent('child', 'parent')
anchestors.register_parent('parent', 'child')
self.assertTrue(anchestors.anchestor_of('child', 'parent'))
self.assertTrue(anchestors.anchestor_of('parent', 'child'))</p>
<p>def test_tree_from_list1(self):
rows = []
result_good = []
result_function = tree_from_list(rows)
self.assertEqual(result_function, result_good)</p>
<p>def test_tree_from_list2(self):
rows = [{'name': 'parent_name', 'parent': None},
<pre>{'name': 'child_name', 'parent': 'parent_name'}]
result_good = [
{'name': 'parent_name',
'parent': None,
'children': [
{'name': 'child_name',
'parent': 'parent_name',
'children': []}]}]
result_function = tree_from_list(
rows,
id_field='name',
parent_field='parent',
children_field='children',
root_parent=None)
self.assertEqual(result_function, result_good)
</pre>
def test_tree_from_list3(self):
rows = [{'name': 'parent_name', 'parent': None},
{'name': 'child_name', 'parent': 'parent_name'},
{'name': 'child_name2', 'parent': 'parent_name'},
{'name': 'child_name3', 'parent': 'parent_name'},
{'name': 'child_child', 'parent': 'child_name3'}]
result_good = [
{'name': 'parent_name',
'parent': None,
'children': [
{'name': 'child_name',
'parent': 'parent_name',
'children': []},
{'name': 'child_name2',
'parent': 'parent_name',
'children': []},
{'name': 'child_name3',
'parent': 'parent_name',
'children': [
<pre>{'name': 'child_child',
'parent': 'child_name3',
'children': []}]},
]}]
result_function = tree_from_list(
rows,
id_field='name',
parent_field='parent',
children_field='children',
root_parent=None)
self.assertEqual(result_function, result_good)
</pre>
def test_tree_from_list_cyclic(self):</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">Test</span> <span class="n">custom</span> <span class="n">settings</span> <span class="k">for</span> <span class="n">MapSettings</span><span class="o">.</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-51'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-51'>#</a>
      </div>
      <p>rows = [{'name': 'child_name', 'parent': 'parent_name'},
<pre>{'name': 'parent_name', 'parent': 'child_name'}]
self.assertRaises(
CycleError,
tree_from_list,
rows,
id_field='name',
parent_field='parent',
children_field='children',
root_parent='parent_name')
</pre>
def test_tree_from_list_cyclic2(self):</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-52'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-52'>#</a>
      </div>
      <p>rows = [{'name': 'parent_name', 'parent': 'parent_name'}, ]
self.assertRaises(
<pre>CycleError,
tree_from_list,
rows,
id_field='name',
parent_field='parent',
children_field='children',
root_parent='child_name')
</pre>
def test_named_list(self):
rows = [
['a', 'b', 'c', 'd'],
['f', 'g', 'h', 'i']]
names = ['name1', 'name2', 'name3', 'name4']
result = named_list(rows, names)
result_good = [
{'name1': 'a', 'name2': 'b', 'name3': 'c', 'name4': 'd'},
{'name1': 'f', 'name2': 'g', 'name3': 'h', 'name4': 'i'}]
self.assertEqual(result, result_good)</p>
<p>def test_unique_list(self):
rows = [1, 2, 2, 3, 4, 5, 5, 7, 2, 5]
result = unique_list(rows)
result_good = [1, 2, 3, 4, 5, 7]
self.assertEqual(result, result_good)</p>
<p>def test_unique_list2(self):
rows = [1, 2], [2, 2], [3, 4], [2, 2], <a href="1, 2], [2, 2], [3, 4], [2, 2], [1, 2.html">1, 2</a>
result = unique_list(rows)
result_good = [1, 2], [2, 2], <a href="1, 2], [2, 2], [3, 4.html">3, 4</a>
self.assertEqual(result, result_good)</p>
<p>class CoordinatesTest(TestCase):
fixtures = ('lizard_map', )</p>
<p>def test_detect_prj1(self):
prj = None
self.assertEquals(
lizard_map.coordinates.detect_prj(prj),
lizard_map.coordinates.RD)</p>
<p>def test_detect_prj2(self):
prj = ('PROJCS["RD_New",GEOGCS["GCS_Amersfoort",'
'DATUM["D_Amersfoort",'
'SPHEROID["Bessel_1841",6377397.155,299.1528128]],'
'PRIMEM["Greenwich",0.0],'
'UNIT["Degree",0.0174532925199433]],'
'PROJECTION["Double_Stereographic"],'
'PARAMETER["False_Easting",155000.0],'
'PARAMETER["False_Northing",463000.0],'
'PARAMETER["Central_Meridian",5.38763888888889],'
'PARAMETER["Scale_Factor",0.9999079],'
'PARAMETER["Latitude_Of_Origin",52.15616055555555],'
'UNIT["Meter",1.0]]')
self.assertEquals(
lizard_map.coordinates.detect_prj(prj),
lizard_map.coordinates.RD)</p>
<p>def test_detect_prj3(self):
prj = ('GEOGCS["GCS_WGS_1984",'
'DATUM["D_WGS_1984",'
'SPHEROID["WGS_1984",6378137.0,298.257223563]],'
'PRIMEM["Greenwich",0.0],'
'UNIT["Degree",0.0174532925199433]]')
self.assertEquals(
lizard_map.coordinates.detect_prj(prj),
lizard_map.coordinates.WGS84)</p>
<p>def test_map_settings(self):</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div><div class='section' id='section-53'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-53'>#</a>
      </div>
      <p>map_settings = lizard_map.coordinates.MapSettings()</p>
<p>self.assertTrue(map_settings.mapnik_projection(),
<pre>lizard_map.coordinates.GOOGLE)
self.assertTrue(map_settings.srid, 900913)
</pre>
def test_map_settings2(self):</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
