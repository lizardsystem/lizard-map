{% extends "lizard_map/lizardgis.html" %}{% load i18n %}{% load map %}

{% block map-javascript %}
<script type="text/javascript"
        src="{{ STATIC_URL }}lizard_map/lizard_wms.js"></script>
{% ifequal base_layer_type "GOOGLE" %}
<script src='http://maps.google.com/maps?file=api&amp;v=2&amp;key={{ googlemaps_api_key }}'></script>
{% endifequal %}
{% ifequal detected_browser 'iPad' %}
{# iPad touch extension from: http://anders.com/cms/352/OpenLayers/iPhone/Android/Touch.Gestures #}
<script type="text/javascript"
        src="{{ STATIC_URL }}touch/touch.js"></script>
<script type="text/javascript"
        src="{{ STATIC_URL }}lizard_map/lizard_touch.js"></script>
{% endifequal %}
{% endblock map-javascript %}

{% block above-content %}
<ul class="map-actions">
  {# Load and save map locations #}
  <li id="map-load-default-location"
      class="map-action"
      data-url="{% url lizard_map.map_location_load_default %}">
    <span class="ss_sprite ss_map_go action-icon"
          title="{% trans 'load default map location' %}"></span>
  </li>
  {% if animation_slider %}{% if use_workspaces %}
  <li id="animation-slider"
      class="map-action"
      data-min="{{ animation_slider.min }}"
      data-max="{{ animation_slider.max }}"
      data-step="{{ animation_slider.step }}"
      data-value="{{ animation_slider.value }}"
      data-ajax-path="{% url lizard_map.set_animation_date %}">
  </li>
  <li class="map-action">
    <span id="selected-date">{{ animation_slider.selected_date|date:"d/m/Y" }}</span>
  </li>
  {% endif %}{% endif %}
  {% if transparency_slider %}
  <li id="transparency-slider"
      class="map-action">
  </li>
  <li class="map-action">
    Transparantie
  </li>
  {% endif %}
  {% for workspace_item in workspaces.temp.0.workspace_items.all %}
  <li class="workspace-empty-temp map-action"
      data-workspace-item-id="{{ workspace_item.id }}">
    <span class="ss_sprite ss_map_delete action-icon">
      {% trans "empty temporary workspace" %}
    </span>
  </li>
  {% endfor %}
</ul>
{% endblock above-content %}

{% block content %}
{# data attributes wms #}
{# All contents of lizard-map-wms must have class lizard-map-wms-item #}
<div id="lizard-map-wms"
     data-javascript-click-handler="{{ javascript_click_handler }}"
     data-javascript-hover-handler="{{ javascript_hover_handler }}"
     {# OSM or WMS #}
     data-base-layer-type="{{ base_layer_type }}"
     {# for WMS: EPSG:28992, EPSG:900913 #}
     data-projection="{{ projection }}"
     {# for WMS: EPSG:28992, EPSG:900913, EPSG:4326 #}
     data-display-projection="{{ display_projection }}"
     {# OSM, google projection #}
     data-startlocation-x="{{ startlocation_x }}"
     data-startlocation-y="{{ startlocation_y }}"
     data-startlocation-zoom="{{ startlocation_zoom }}"
     data-base-layer-wms="{{ base_layer_wms }}"
     data-base-layer-wms-layers="{{ base_layer_wms_layers }}"
     data-base-layer-osm="{{ base_layer_osm }}"
     {# URLS for saving, loading map locations #}
     data-save-location-url="{% url lizard_map.map_location_save %}"
     data-load-location-url="{% url lizard_map.map_location_load_default %}"
     >
  {# Make a layer for every workspace #}
  {% for workspace_list in workspaces.values %}
    {% for workspace in workspace_list %}
    <div class="workspace-layer lizard-map-wms-item"
         data-workspace-id="{{ workspace.id }}"
         data-workspace-name="{{ workspace.name }}"
         data-workspace-wms="{% url lizard_map_wms workspace_id=workspace.id %}">
    </div>
    {# Add wms layers from every workspace #}
      {% for wms_layer in workspace.wms_layers %}
      {% autoescape off %}
      <div class="workspace-wms-layer lizard-map-wms-item"
           data-workspace-wms-id="{{ wms_layer.wms_id }}"
           data-workspace-wms-name="{{ wms_layer.name }}"
           data-workspace-wms-url="{{ wms_layer.url }}"
           {# json uses "" #}
           data-workspace-wms-params='{{ wms_layer.params }}'
           data-workspace-wms-options='{{ wms_layer.options }}'>
      </div>
      {% endautoescape %}
      {% endfor %}
    {% endfor %}
  {% endfor %}
</div>
<div id="map"></div>
{% endblock content %}
